{
  "dataSchema" : {
    "dataSource" : "$dataSource",
    "parser" : {
      "type" : "string",
      "parseSpec" : {
        "format" : "tsv",
        "timestampSpec" : {
          "column" : "rqTime",
          "format" : "auto"
        },
        "dimensionsSpec" : {
          "dimensions": ["rqTime","rqSiteId","rqSiteClassification","rqSiteName","rqSiteUrl","rqInventoryType","rqCcountryId","rqCountry","rqGeoState","rqGeoCity","rqGeoZip","rqHandsetId","rqIntMethod","rqIntgVersion","rqIntgFamily","rqAdFormat","rqAdSlot","rqPoiCategory","rqCatDistanceBucket","rqLocationContext","rqCustomRegionFence","persona","personaType","dataVendor"],
          "dimensionExclusions" : [],
          "spatialDimensions" : []
        },
       "delimiter" : "\u0001",
       "listDelimiter" : ",",
	"columns" : ["rqTime","rqSiteId","rqSiteClassification","rqSiteName","rqSiteUrl","rqInventoryType","rqCcountryId","rqCountry","rqGeoState","rqGeoCity","rqGeoZip","rqHandsetId","rqIntMethod","rqIntgVersion","rqIntgFamily","rqAdFormat","rqAdSlot","rqPoiCategory","rqCatDistanceBucket","rqLocationContext","rqCustomRegionFence","rqNID","validAdRequests","impressionsServed","impressionsRendered","totalBurn","persona","personaType","dataVendor"]      
	}
    },
    "metricsSpec" : [
      {
        "type" : "count",
        "name" : "count"
      },
      {
        "type" : "longSum",
        "name" : "validAdRequests",
        "fieldName" : "validAdRequests"
      },
      {
        "type" : "longSum",
        "name" : "impressionsServed",
        "fieldName" : "impressionsServed"
      },
      {
        "type" : "longSum",
        "name" : "impressionsRendered",
        "fieldName" : "impressionsRendered"
      },
      {
        "type" : "doubleSum",
        "name" : "totalBurn",
        "fieldName" : "totalBurn"
      },
      {
	 "type": "hyperUnique",
         "name": "uniqueUsers",
         "fieldName": "rqNID" 
     }
    ],
    "granularitySpec" : {
      "type" : "uniform",
      "segmentGranularity" : "DAY",
      "queryGranularity" : "DAY",
      "intervals" : [ "$day1T00:00:00.000/$day2T00:00:00.000" ]
    }
  },
  "ioConfig" : {
    "type" : "hadoop",
    "inputSpec" : {
      "type" : "static",
      "paths" : "$inputPaths"
    },
    "metadataUpdateSpec" : {
      "type":"mysql",
      "connectURI" : "jdbc:mysql://glmd1001.grid.uh1.inmobi.com:3306/druid",
      "password" : "$mysqlPassword",
      "segmentTable" : "druid_segments",
      "user" : "$mysqlUser"
    },
	"segmentOutputPath" : "$ingestDir/ingest/$day1_$day2/$dataSource/"
  },
  "tuningConfig" : {
    "type" : "hadoop",
     "workingPath": "$ingestDir/ingest/$day1_$day2",
    "partitionsSpec" : {
      "type" : "hashed",
      "partitionDimension" : null,
      "targetPartitionSize" : 2000000,
      "maxPartitionSize" : 5000000,
      "assumeGrouped" : true,
      "numShards" : -1
    },
    "shardSpecs" : null,
    "leaveIntermediate" : false,
    "cleanupOnFailure" : true,
    "overwriteFiles" : false,
    "ignoreInvalidRows" : false,
    "jobProperties" : {"mapred.job.user.name":"$userName","mapred.job.queue.name":"$queueName","yarn.app.mapreduce.am.command-opts":"-Xmx4216m -XX:MaxMetaspaceSize=128m -Dhdp.version=${hdp.version}","yarn.app.mapreduce.am.resource.mb":4608,"mapreduce.reduce.memory.mb":7372,"mapreduce.reduce.java.opts":"-Xmx6144m","mapreduce.task.timeout":2700000,"mapreduce.task.userlog.limit.kb":0 },
    "combineText" : false,
    "persistInHeap" : false,
    "ingestOffheap" : false
  }
}
